<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="styles/login.css"/>
	<!--不可以这么写<script type="text/javascript" src="scripts/jquery.min.js"/>-->
	<script type="text/javascript" src="scripts/jquery.min.js"></script>
	<script type="text/javascript" src="scripts/cookie_util.js"></script>
	<script type="text/javascript">
		$(function(){
		    $("#login").click(function () {
                $("#count_span").html("");
                $("#password_span").html("");
		        //获取参数
				var name=$("#count").val().trim();
				var password=$("#password").val().trim();
				var ok=true;
				if(name==""){
                    $("#count_span").html("用户名不能为空");
                    ok=false;
				}
                if(password==""){
                    $("#password_span").html("密码不能为空");
                    ok=false;
                }
                //发送请求
				if(ok){
                    $.ajax({
                        //为何14 unit2-1  1.51.25  写的是完整路径
                        url:'/user/login.form',
						type:'post',
						data:{"name":name,"password":password},
                        dataType:'json',
                        success:function(result){
                            if(result.status==0){
                                //14  获取用户ID，写入cookie
								var userId=result.data.cn_user_id;
								addCookie("uid",userId,2);
                                window.location.href="index.jsp";
							}else if(result.status==1){
								$("#count_span").html(result.msg);
							}else if(result.status==2){
                                $("#password_span").html(result.msg);
                            }
                        },
                        error:function(){
                            alert("登录失败");
                        }
                    });
				}

            });
		});
	</script>
	<script type="text/javascript">
        $(function(){
            $("#regist_button").click(function(){
                //清除提示信息
                $("#warning_1").hide();
                $("#warning_2").hide();
                $("#warning_3").hide();
                $("#warning_4").hide();
                //获取请求参数
                var name = $("#regist_username").val().trim();
                var nick = $("#nickname").val().trim();
                var password = $("#regist_password").val().trim();
                var final_password = $("#final_password").val().trim();
                //检查格式
                var ok = true;
                if(name==""){
                    ok = false;
                    $("#warning_1 span").html("用户名为空");
                    $("#warning_1").show();
                }
                if(nick==""){
                    ok = false;
                    $("#warning_4 span").html("昵称为空");
                    $("#warning_4").show();
                }
                if(password==""){
                    ok = false;
                    $("#warning_2 span").html("密码为空");
                    $("#warning_2").show();
                }else{
                    if(password.length<6){
                        ok = false;
                        $("#warning_2 span").html("密码需要6位以上");
                        $("#warning_2").show();
                    }
                }
                if(final_password != password){
                    ok = false;
                    $("#warning_3 span").html("与密码不一致");
                    $("#warning_3").show();
                }
                //发送Ajax
                if(ok){
                    $.ajax({
                        url:"/user/regist.form",
                        //url:"http://localhost:8080/user/regist.form",
                        type:"post",
                        data:{"name":name,"password":password,"nick":nick},
                        dataType:"json",
                        success:function(result){
                            if(result.status==0){//成功
                                alert(result.msg);//提示
                                $("#back").click();//切换到登录界面
                            }else if(result.status==1){//用户名占用
                                $("#warning_1 span").html(result.msg);
                                $("#warning_1").show();
                            }
                        },
                        error:function(){
                            alert("注册失败,稍后重试");
                        }
                    });
                }
            });
        });
	</script>
</head>
<body>
<div class="global">
	<div class="log log_in" tabindex='-1' id='dl'>
		<dl>
			<dt>
				<div class='header'>
					<h3>登&nbsp;录</h3>
				</div>
			</dt>
			<dt></dt>
			<dt>
				<div class='letter'>
					用户名:&nbsp;<input type="text" name="" id="count" tabindex='1'/>
					<span id="count_span"></span>
				</div>
			</dt>
			<dt>
				<div class='letter'>
					密&nbsp;&nbsp;&nbsp;码:&nbsp;<input type="password" name="" id="password" tabindex='2'/>
					<span id="password_span"></span>
				</div>
			</dt>
			<dt>
			<div>
				<input type="button" name="" id="login" value='&nbsp登&nbsp录&nbsp' tabindex='3'/>
				<input type="button" name="" id="sig_in" value='&nbsp注&nbsp册&nbsp' tabindex='4'/>
			</div>
			</dt>
		</dl>
	</div>
	<div class="sig sig_out" tabindex='-1' id='zc' style='visibility:hidden;'>
		<dl>
			<dt>
				<div class='header'>
					<h3>注&nbsp;册</h3>
				</div>
			</dt>
			<dt></dt>
			<dt>
				<div class='letter'>
					用户名:&nbsp;<input type="text" name="" id="regist_username" tabindex='5'/>
					<div class='warning' id='warning_1'><span>该用户名不可用</span></div>
				</div>
			</dt>
			<dt>
				<div class='letter'>
					昵&nbsp;&nbsp;&nbsp;称:&nbsp;<input type="text" name="" id="nickname" tabindex='6'/>
					<div class="warning" id="warning_4"><span></span></div>
				</div>
			</dt>
			<dt>
				<div class='letter'>
					密&nbsp;&nbsp;&nbsp;码:&nbsp;<input type="password" name="" id="regist_password" tabindex='7'/>
					<div class='warning' id='warning_2'><span>密码长度过短</span></div>
				</div>
			</dt>
			<dt>
				<div class='password'>
					&nbsp;&nbsp;&nbsp;确认密码:&nbsp;<input type="password" name="" id="final_password" tabindex='8'/>
					<div class='warning' id='warning_3'><span>密码输入不一致</span></div>
				</div>
			</dt>
			<dt>
				<div>
					<input type="button" name="" id="regist_button" value='&nbsp注&nbsp册&nbsp' tabindex='9'/>
					<input type="button" name="" id="back" value='&nbsp返&nbsp回&nbsp' tabindex='10'/>
					<script type="text/javascript">
						function get(e){
							return document.getElementById(e);
						}
						get('sig_in').onclick=function(){
							get('dl').className='log log_out';
							get('zc').className='sig sig_in';
						}
						get('back').onclick=function(){
							get('zc').className='sig sig_out';
							get('dl').className='log log_in';
						}
						//这里是加载页面后马上执行setTimeout
						window.onload=function(){
						    //定义t，之后要取消这个定时任务可以用clearTimeout(t);
							var t =setTimeout("get('zc').style.visibility='visible'",80);
							get('final_password').onblur=function(){
								var npassword=get('regist_password').value;
								var fpassword=get('final_password').value;
								if(npassword!=fpassword){
									get('warning_3').style.display='block';
								}
							}
							get('regist_password').onblur=function(){
								var npassword=get('regist_password').value.length;
								if(npassword<6&&npassword>0){
									get('warning_2').style.display='block';
								}
							}
							get('regist_password').onfocus=function(){
								get('warning_2').style.display='none';
							}
							get('final_password').onfocus=function(){
								get('warning_3').style.display='none';
							}
						}
					</script>
				</div>
			</dt>
		</dl>
	</div>
</div>
</body>
</html>